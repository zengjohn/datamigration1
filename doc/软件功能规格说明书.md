# 数据迁移与清洗平台 - 功能规格说明书

**版本**：V1.0

**适用对象**：后端开发、产品经理、测试人员

### 1. 产品概述

本软件是一个高性能、高并发的 CSV 数据迁移工具。它负责监控指定目录下的 CSV 文件，将其自动转码、切分为小文件，多线程并行装载至目标数据库，并进行最终的数据校验。系统具备断点续传、故障恢复和人工干预能力。

### 2. 核心功能模块

#### 2.1 作业管理 (Job Management)

- **创建作业**：支持配置作业名称、**源文件监控目录**、**目标数据库连接信息**（URL/账号/密码）。作业创建后默认为“运行中 (ACTIVE)”状态。
- **作业列表**：查看所有迁移作业及其当前状态。
- **全局控制**：
  - **暂停/停止**：用户可随时停止作业。后台会立刻停止分发新任务，并尝试中断正在进行的耗时操作（利用中断异常机制）。
  - **恢复**：将停止的作业恢复为 ACTIVE，调度器自动继续处理未完成的任务。

#### 2.2 自动化调度流程 (Automated Scheduler)

系统后台内置调度器（每 5 秒轮询），按以下阶段自动流转数据：

1. **文件扫描**：监控源目录，发现新 CSV 文件即生成 `Detail` 记录（状态 `NEW`）。
2. **转码与切分 (Transcode)**：
   - 将大文件转码（如 IBM1388 -> UTF8）。
   - 按行数拆分为多个小切片 (`Split`)。
   - **容错**：支持“幂等执行”，若中途失败，重试时会自动清理旧脏数据。
3. **多线程装载 (Load)**：
   - 利用数据库乐观锁机制，多线程并发抢占 `Split` 任务。
   - 将切片数据批量写入目标库。
4. **数据校验 (Verify)**：
   - 装载完成后自动触发校验逻辑。
   - 校验通过后标记为 `PASS`，并删除临时切片文件。

#### 2.3 状态与异常管理

- **三级状态体系**：
  - **Job**: `ACTIVE` (运行), `STOPPED` (停止)
  - **Detail**: `NEW`, `TRANSCODING`, `PROCESSING_CHILDS` (子任务处理中), `FINISHED`
  - **Split**: `WAIT_LOAD`, `LOADING`, `WAIT_VERIFY`, `VERIFYING`, `PASS`, `FAIL_XX`
- **故障自愈 (Failover)**：
  - **启动恢复**：系统重启时，自动检测并重置处于中间状态（如 `LOADING`）的僵尸任务。
  - **人工重试**：对于明确标记为 `FAIL`（失败）的切片，提供人工“重试”按钮，重置状态等待调度器再次接管。