### 冒烟测试流程 (Smoke Test)

**冒烟测试定义**：在深入测试之前，对系统的核心链路进行一次快速验证，确保程序“跑得通”，没有重大阻塞性 Bug。

**前置条件**：

1. Spring Boot 应用已启动，无报错日志。
2. 数据库 (`MySQL`) 连接正常，表结构已初始化。
3. 前端页面 (`index.html`) 可在浏览器访问。

#### 测试用例 1：全流程自动化 (Happy Path)

**目标**：验证从创建作业到数据最终完成的自动化链路。

| **步骤** | **操作描述**                                                 | **预期结果**                                                 |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **1**    | **创建作业** 点击“新建迁移作业”，输入名称“SmokeTest”、目录 `/tmp/test`，点击提交。 | 1. 列表刷新，出现新作业。 <br />2. 状态显示为 `ACTIVE`。 <br />3. 数据库 `t_migration_job` 新增一条记录。 |
| **2**    | **模拟文件发现** 直接在数据库执行 SQL： `INSERT INTO t_qianyi_detail (job_id, file_name, status, update_time) VALUES ({jobId}, 'Test.csv', 'NEW', NOW());` | 1. 前端点击作业，右侧文件列表出现 `Test.csv`，状态 `NEW`。 <br />2. 几秒后，状态自动变为 `TRANSCODING`。 |
| **3**    | **观察转码与拆分** 观察控制台日志或等待 3-5 秒。             | 1. Detail 状态变为 `PROCESSING_CHILDS` (蓝色)。 <br />2. 点击“查看切片”，弹窗中出现 3 个切片 (代码模拟逻辑)。 <br />3. 切片初始状态为 `WAIT_LOAD`。 |
| **4**    | **观察装载流程** 观察切片列表的状态变化（自动刷新）。        | 1. 切片状态依次变为 `LOADING` -> `WAIT_VERIFY`。 <br />2. 控制台输出 `[Load] 装载完成...`。 |
| **5**    | **观察校验与完结** 继续观察。                                | 1. 切片状态变为 `VERIFYING` -> `PASS` (绿色)。 <br />2. 当所有切片都 PASS 后，关闭弹窗，观察父文件 Detail 状态。 <br />3. Detail 状态变为 `FINISHED` (绿色)。 |

#### 测试用例 2：人工干预与重试 (Error & Retry)

**目标**：验证系统的容错机制和人工运维功能。

| **步骤** | **操作描述**                                                 | **预期结果**                                                 |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **1**    | **制造故障** 在流程跑到一半时（或流程结束后），手动修改数据库： `UPDATE t_csv_split SET status='FAIL_LOAD', error_msg='模拟断网' WHERE id={splitId};` | 1. 前端切片弹窗中，该切片立即变红。 <br />2. 状态显示 `FAIL_LOAD`。 <br />3. 出现黄色“♻️ 重试”按钮。 |
| **2**    | **执行重试** 点击前端的“重试”按钮。                          | 1. 按钮消失或变为不可点。 <br />2. 状态立即变为 `WAIT_LOAD`。 <br />3. 错误信息变为“重试指令...”。 |
| **3**    | **验证恢复** 等待 5-10 秒。                                  | 1. 调度器重新捡起该任务。 <br />2. 状态流转：`LOADING` -> `WAIT_VERIFY` ... -> `PASS`。 <br />3. 故障修复成功。 |

#### 测试用例 3：全局停止 (Global Stop)

**目标**：验证紧急制动功能。

| **步骤** | **操作描述**                                             | **预期结果**                                                 |
| -------- | -------------------------------------------------------- | ------------------------------------------------------------ |
| **1**    | **停止作业** 在左侧作业列表，点击红色“停止”按钮。        | 1. 弹出确认框，确认后状态变为 `STOPPED` (灰色)。 <br />2. 按钮变为绿色的“恢复”。 <br />3. 后端日志显示“作业已停止”。 |
| **2**    | **验证调度停止** 此时往 DB 插入一个新的 `NEW` 状态文件。 | 1. 即使过了很久，该文件的状态也一直停留在 `NEW`。 <br />2. 没有任何 Log 显示开始转码。 |
| **3**    | **恢复作业** 点击绿色“恢复”按钮。                        | 1. 状态变回 `ACTIVE`。 <br />2. 几秒内，刚才卡住的 `NEW` 文件开始转码，流程继续。 |