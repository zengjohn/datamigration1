server:
  port: 8080 # 提供 HTTP 查询接口的端口

spring:
  application:
    name: moveprog
  autoconfigure:
    exclude: com.github.gavlyukovskiy.boot.jdbc.decorator.DataSourceDecoratorAutoConfiguration
  web:
    resources:
      # 关键配置：指定静态资源查找路径
      # file:./static/ 表示当前运行目录下的 static 文件夹 (优先级高)
      # classpath:/static/ 表示 Jar 包内部的默认文件夹 (优先级低，作为兜底)
      static-locations: file:./static/, classpath:/static/

  # 数据库配置 (存放 qianyi_main, qianyi_detail 的元数据库)
  datasource:
    url: jdbc:mysql://localtestdb:3306/test1?useSSL=false&useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai&rewriteBatchedStatements=true&allowMultiQueries=true&tinyInt1isBit=false&yearIsDateType=false&allowPublicKeyRetrieval=true&connectTimeout=360000&socketTimeout=3600000&failOverReadOnly=false&failOverReadOnly=false&autoReconnect=true
    username: root
    password: 111111
    driver-class-name: com.mysql.cj.jdbc.Driver

  # JPA 配置
  jpa:
    hibernate:
      ddl-auto: update # 第一次运行时会自动建表，生产环境建议改为 validate
    show-sql: false
    open-in-view: false

  # 线程池配置 (如果你启用了上面的虚拟线程 Bean，这里就不太重要了，但保留也没事)
  task:
    execution:
      pool:
        core-size: 10
        max-size: 50

# 自定义应用配置
app:
  # CSV 配置
  csv:
    # 1. 源文件 IBM1388 配置
    ibm-source:
      encoding: UTF-8        # 核心编码
      # [关键] 换行符设置
      # 方式 A: 自动检测 (推荐，能适应 \n 和 \r\n)
      #line-separator: AUTO
      # 方式 B: 强制指定 (如果你非常确定)
      # line-separator: "\n"
      # [关键] 大机文件通常字段很多或很长，防止报错
      max-chars-per-column: 50000
      # 假如源文件用分号分隔
      #delimiter: ;
      # 假如源文件不带引号
      #quote: "\0"  # 这是一个特殊技巧，用空字符表示无引号

    # 2. 中间文件 UTF-8 配置
    utf8-split:
      encoding: UTF-8

  # 3. 性能参数调优
  performance:
    read-buffer-size: 16777216  # 16MB (读取大文件建议加大)
    write-buffer-size: 2097152  # 2MB
    split-rows: 2000000          # 多少行切分一个文件
    max-chars-per-column: 100000 # 防止某些超长备注导致OOM

  migration-thread-pool:
    transcode:
      core-pool-size: 2
      max-pool-size: 4
    load:
      core-pool-size: 5
      max-pool-size: 10
    verify:
      core-pool-size: 5
      max-pool-size: 10

  # 路径配置 (保留之前的)
  job:
    output-dir: /data/moveprog/output_split/
    error-dir: /data/moveprog/output_error/

  load-jdbc:
    pre-sql-list:
      - "SET unique_checks=0"
      - "SET foreign_key_checks=0"
      - "SET sql_log_bin=0"
      - "SET SESSION tx_isolation = 'READ-UNCOMMITTED'"
    url-options: "?Unicode=true&useSSL=false&characterEncoding=utf8&allowLoadLocalInfile=true&rewriteBatchedStatements=true&useServerPrepStmts=false&cachePrepStmts=false&tinyInt1isBit=false&yearIsDateType=false&socketTimeout=3600000&connectTimeout=30000&autoReconnect=true&failOverReadOnly=false&useCompression=true&tdsqlLoadDataMode=fast&tdsqlSkipSlaveCheck=true&tdsqlBatchSize=1000000"

  verify:
    strategy: USE_SOURCE_FILE
    max-diff-count: 1000
    verify-result-base-path: /data/moveprog/verify_result

logging:
  level:
    org:
      hibernate:
        SQL: INFO
        type:
          descriptor:
            sql:
              BasicBinder: INFO
        orm:
          jdbc:
            bind: INFO
  # P6Spy 配置 (前提是引入了 p6spy-spring-boot-starter)
  decorator:
    datasource:
      enabled: false
      p6spy:
        enable-logging: false
        # 开启多行变单行，去掉了换行符，方便复制
        multiline: true
        # 自定义日志格式：执行时间 | SQL语句
        log-format: "%(executionTime) ms | %(sql)"